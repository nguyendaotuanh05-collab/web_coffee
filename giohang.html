<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/popup.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/lienhe.css">
    <link rel="stylesheet" href="css/bootstrap/css/bootstrap.min.css">
    <script src="css/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/cdd11b4a6d.js" crossorigin="anonymous"></script>
    <title>Trang chủ - Eclipse</title>
</head>

<body>
    <div class="container">
        <!-- nhận dạng -->
        <div class="row">
            <div class="head">
                E C L I P S E
            </div>
        </div>

        <!-- slide bar -->
        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-12">
                <div id="sidebar" class="sidebar">
                    <button class="close-btn" onclick="toggleSidebar()">×</button>
                    <h2 class="slidebar-title">Eclipse</h2>
                    <a href="Trangchu.html">Trang chủ</a>
                    <a href="vechungtoi.html">Về chúng tôi</a>
                    <a href="details_menu1/menu1.html">Cà phê</a>
                    <a href="details_menu2/menu2.html">Trà</a>
                    <a href="details_menu3/menu3.html">Freeze</a>
                    <a href="details_menu4/menu4.html">Mojito</a>
                    <a href="lienhe.html">Liên hệ</a>
                </div>
                <button class="open-btn" onclick="toggleSidebar()" id="toggleButton">☰</button>
            </div>
        </div>

        <header>
            <!-- menu chính -->
            <div class="row">
                <!-- logo -->
                <div class="col-lg-3 col-md-3 col-sm-12">
                    <a href="Trangchu.html" class="logo">
                        <img src="img/trangchu/logo.png" alt="" class="img-fluid" width="150px" height="150px">
                    </a>
                </div>

                <!-- menu -->
                <div class="col-lg-6 col-md-6 col-sm-12">
                    <nav class="navbar navbar-expand-lg bg-body-tertiary">
                        <div class="container-fluid">
                            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                    <li class="nav-item">
                                        <a class="nav-link" aria-current="page" href="Trangchu.html">Trang chủ</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="vechungtoi.html">Về chúng tôi</a>
                                    </li>
                                    <li class="nav-item dropdown">
                                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown">
                                            Menu
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="details_menu1/menu1.html">Cà phê</a></li>
                                            <li><a class="dropdown-item" href="details_menu2/menu2.html">Trà</a></li>
                                            <li><a class="dropdown-item" href="details_menu3/menu3.html">Freeze</a></li>
                                            <li><a class="dropdown-item" href="details_menu4/menu4.html">Mojito</a></li>
                                        </ul>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="lienhe.html">Liên hệ</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                </div>

                <!-- icon -->
                <div class="col-lg-3 col-md-3 col-sm-12">
                    <div class="item">
                        <div class="cart-icon">
                            <a href="giohang.html">
                                <i class="fa-solid fa-cart-shopping"></i>
                                <span id="cart-count">0</span>
                            </a>
                        </div>


                        <div class="login">
                            <div class="navbar">
                                <div class="account-dropdown">
                                    <div class="account-icon"><i class="fa-solid fa-user"> </i></div>
                                    <div class="dropdown-menu" id="avatar-action-container">
                                        <span id="user-info"></span>
                                        <a href="dangki.html" id="signup-link">Đăng ký</a>
                                        <a href="dangnhap.html" id="login-link">Đăng nhập</a>
                                        <a href="userinfo.html" id="user-page-link" style="display: none;">Thông tin
                                            </br> cá nhân</a>
                                        <a href="#" id="logout-link" style="display: none;" onclick="logout()">Đăng
                                            xuất</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </header>

        <!-- banner -->
        <div class="ban">
            <div class="row">
                <h1>Giỏ hàng</h1>
                <p><a href="Trangchu.html">Trang chủ</a> / Giỏ hàng của bạn</p>
            </div>
        </div>

        <!-- nội dung giỏ hàng -->
        <div class="cart">
            <h1>Giỏ hàng của bạn</h1>
            <div id="cart-items"></div>
            <div class="cart-footer">
                <p id="total-price">Tổng tiền: 0đ</p>
               	
<button id="checkout-momo" class="btn btn-primary">Thanh Toán MOMO</button>
            </div>
        </div>


        <!-- footer -->
        <div class="row">
            <div class="footer">
                <div class="py-3 border-top mt-3">
                    <div class="row">
                        <div class="col-md-3">
                            <h4>Địa chỉ</h4>
                            <p>Địa chỉ: Hóc Môn, Tp. Hồ Chí Minh
                                <br>Hotline: 09.0802.2106
                                <br>Gmail: EclipseCf@gmail.com
                            </p>
                        </div>
                        <div class="col-md-3">
                            <h4>Về chúng tôi</h4>
                            <p>Eclipse mang phong cách hiện đại, sang trọng nhưng vẫn ấm cúng. Lấy cảm hứng từ sự huyền
                                bí
                                của nguyệt thực,
                                quán có tông màu trầm kết hợp ánh đèn dịu nhẹ, tạo cảm giác thư giãn nhưng vẫn đầy chất
                                nghệ
                                thuật.</p>
                        </div>
                        <div class="col-md-3">
                            <h4>Liên kết</h4>
                            <ul>
                                <li>Tìm kiếm</li>
                                <li>Menu</li>
                                <li>Chăm sóc khách hàng </li>
                            </ul>
                        </div>
                        <div class="col-md-3">
                            <h4>Kết nối với Eclipse Café</h4>
                            <ul>
                                <li>Facebook</li>
                                <li>Instagram</li>
                                <li>Youtube</li>
                                <li>Google</li>
                            </ul>
                        </div>
                    </div>
                    <p class="copyright">&copy; Copyright 2025 Eclipse, All rights reserved</p>
                </div>
            </div>
        </div>


        <script src="js/func.js"></script>
        <script src="js/cart.js"></script>
        <script src="js/dangki.js"></script>
        <script src="js/droplogin.js"></script>


    </div>
    <!-- BẮT ĐẦU CODE GỌI MOMO FUNCTION -->
<script>
   document.addEventListener("DOMContentLoaded", function () {
    // ... (các hàm khác) ...
    
    // Xử lý sự kiện thanh toán
    document.getElementById("checkout").addEventListener("click", async function () { 
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        if (cart.length === 0) {
            alert("Giỏ hàng của bạn đang trống!"); 
            return;
        }

        // 1. Tính toán Tổng tiền và tạo OrderInfo (Front-end Logic)
        let totalPrice = 0;
        cart.forEach((item) => {
            // Đảm bảo item.price được parse đúng (ví dụ: loại bỏ "đ")
            const priceValue = parseFloat(item.price.replace(/[^\d]/g, ''));
            totalPrice += priceValue * item.quantity;
        });
        
        // Tạo Order ID và Order Info (sử dụng hàm createOrderInfo đã thêm vào)
        const orderId = 'ECL_' + Date.now(); 
        const orderInfo = createOrderInfo(cart); 

        // 2. Gửi yêu cầu đến Back-end để tạo giao dịch MoMo
        try {
            // Thay '/api/checkout/momo' bằng endpoint API thực tế của server Node.js của bạn
            const response = await fetch('/api/checkout/momo', { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    orderId: orderId,
                    amount: totalPrice, // Gửi tổng tiền (đơn vị: VNĐ)
                    orderInfo: orderInfo,
                    //... các thông tin khác cần lưu vào DB ...
                }),
            });

            const data = await response.json();

            if (data.payUrl) {
                // 3. Chuyển hướng người dùng đến cổng thanh toán MoMo
                window.location.href = data.payUrl;
            } else {
                alert("Lỗi khi tạo giao dịch MoMo: " + data.message);
            }

        } catch (error) {
            console.error('Lỗi khi gọi API thanh toán:', error);
            alert("Đã xảy ra lỗi trong quá trình kết nối thanh toán.");
        }
    });
});
</script>
<!-- KẾT THÚC CODE GỌI MOMO FUNCTION -->

    </div>
</body>

</html>
